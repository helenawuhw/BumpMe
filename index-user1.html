<!DOCTYPE html>
<html>
<head>
	<!-- capital one key: 4251fb7f94e1e834bdaae6f55dd61b48 -->
	<meta charset="utf-8">
	<title>BumpUp</title>
	<script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
	<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>
	<link rel="stylesheet" href="odometer-theme-plaza.css" />
	<link href="https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.css" rel="stylesheet" type="text/css" />
    <link href='http://fonts.googleapis.com/css?family=Oxygen:300' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">
	<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
	<script src="odometer.min.js"></script>
	<link rel="stylesheet" href="styles.css" />


</head>
<body>
	<i class="fa fa-fire" aria-hidden="true"></i>
	<div id='cal'>355KCal</div>


	<i class="fa fa-map" aria-hidden="true"></i>
	<div id ='distance'>3.56mi</div>


	<i class="fa fa-money" aria-hidden="true"></i>
	<div class='dollar'>$</div>
	<div class='odometer money'>
		111
	</div>
	<button id="button">
		Get my Balance
	</button>
	<div id = 'message'>
	</div>

	<!-- Transactions --> 
	<i class="fa fa-exchange" aria-hidden="true"></i>
	<div id="transaction">
		Recent
	</div>
	<ul id = "list">
		<li>www</li>
	</ul>

	<i class="fa fa-flag-checkered" aria-hidden="true"></i>
	<div id="steps">Daily Steps</div>

	<script>
		var initialDataLoaded = false;
		var user = "user1";
		var against_user = "user2";
		var unit = 0.01;
		var apikey = '4251fb7f94e1e834bdaae6f55dd61b48';
		var accountId = '5712bd2f01c7065b0fceb52a';
		var payee_accountId = "5712d9d801c7065b0fceb542";
		var db = new Firebase('https://bumpup.firebaseio.com/');
		 // with jQuery
		
		   	$.ajax({
		    url: 'http://api.reimaginebanking.com/accounts/' + accountId + '?key='+apikey,
		    success: function(results){
		        balance = results['balance'];
				$('.odometer').text(balance);
		    }});
		
		db.on('child_added', function(new_event){
			if (initialDataLoaded){
					var msg = new_event.val();
				var calorie_diff;
				console.log(msg.userone.name);
				if(msg.userone.name == user){
					calorie_diff = msg.userone.calorie - msg.usertwo.calorie; // self comes first
				}
				else{
					calorie_diff = msg.usertwo.calorie - msg.userone.calorie; // self comes first
				}
				console.log(calorie_diff);
				if (calorie_diff < 0){
					console.log("i pay");
					// you gotta pay the other one;
					transfer = parseFloat(calorie_diff * unit);
					var d = new Date();
					var date = d.getFullYear() + '-' + ('0' + String(d.getMonth()+1)).slice(-2) + '-' + d.getDate();

					var datum = JSON.stringify({
					  	"medium": "balance",
					  	"payee_id": payee_accountId,
					  	"transaction_date": date,
					  	"description": "run",
					  	"amount": Math.abs(transfer)
					});
					console.log(datum);
					$.ajax({
						url:'http://api.reimaginebanking.com/accounts/'+ accountId + '/transfers?key=' + apikey,
						data: datum,
						type:'POST',
						contentType:'application/json',
						success: function (dat) {
		                	$('#message').html(dat.message);
	            		}
			    	});
				}
					
				
			    function waitAjax(){
			    	$.ajax({
			    	url: 'http://api.reimaginebanking.com/accounts/' + accountId + '?key='+apikey,
			    	success: function(results){
			    	console.log('ss');
			        balance = results['balance'];  
			    }});
			    }

			   	function updateBalance(){
			   		var value = balance;
			   		var id = setInterval(function(){
			   			if(value!=balance){
			   				$('.odometer').text(balance);
			   				clearInterval(id);
			   			}
			   			else{
			   				waitAjax();
			   			}
			   		}, 1000);

			   	}

			   	// Delete setTimeout after working
			   	updateBalance();
				
			}
			
		})
	db.once('value', function(snapshot) {
		  initialDataLoaded = true;
		});
	</script>

<br><br><br><br><br><br><br><br><br><br><br><br>
	<center><div style="height:500px; width:750px;" class="ct-chart"></div>
	    <script src="https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>

	<script>

	var chart = new Chartist.Line('.ct-chart', {
  labels: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'],
  series: [
    [12, 9, 7, 8, 5, 4, 6, 2, 3, 3, 4, 6]
  ]
}, {
  low: 0
});

// Let's put a sequence number aside so we can use it in the event callbacks
var seq = 0,
  delays = 80,
  durations = 250;

// Once the chart is fully created we reset the sequence
chart.on('created', function() {
  seq = 0;
});

// On each drawn element by Chartist we use the Chartist.Svg API to trigger SMIL animations
chart.on('draw', function(data) {
  seq++;

  if(data.type === 'line') {
    // If the drawn element is a line we do a simple opacity fade in. This could also be achieved using CSS3 animations.
    data.element.animate({
      opacity: {
        // The delay when we like to start the animation
        begin: seq * delays + 1000,
        // Duration of the animation
        dur: durations,
        // The value where the animation should start
        from: 0,
        // The value where it should end
        to: 1
      }
    });
  } else if(data.type === 'label' && data.axis === 'x') {
    data.element.animate({
      y: {
        begin: seq * delays,
        dur: durations,
        from: data.y + 100,
        to: data.y,
        // We can specify an easing function from Chartist.Svg.Easing
        easing: 'easeOutQuart'
      }
    });
  } else if(data.type === 'label' && data.axis === 'y') {
    data.element.animate({
      x: {
        begin: seq * delays,
        dur: durations,
        from: data.x - 100,
        to: data.x,
        easing: 'easeOutQuart'
      }
    });
  } else if(data.type === 'point') {
    data.element.animate({
      x1: {
        begin: seq * delays,
        dur: durations,
        from: data.x - 10,
        to: data.x,
        easing: 'easeOutQuart'
      },
      x2: {
        begin: seq * delays,
        dur: durations,
        from: data.x - 10,
        to: data.x,
        easing: 'easeOutQuart'
      },
      opacity: {
        begin: seq * delays,
        dur: durations,
        from: 0,
        to: 1,
        easing: 'easeOutQuart'
      }
    });
  } else if(data.type === 'grid') {
    // Using data.axis we get x or y which we can use to construct our animation definition objects
    var pos1Animation = {
      begin: seq * delays,
      dur: durations,
      from: data[data.axis.units.pos + '1'] - 30,
      to: data[data.axis.units.pos + '1'],
      easing: 'easeOutQuart'
    };

    var pos2Animation = {
      begin: seq * delays,
      dur: durations,
      from: data[data.axis.units.pos + '2'] - 100,
      to: data[data.axis.units.pos + '2'],
      easing: 'easeOutQuart'
    };

    var animations = {};
    animations[data.axis.units.pos + '1'] = pos1Animation;
    animations[data.axis.units.pos + '2'] = pos2Animation;
    animations['opacity'] = {
      begin: seq * delays,
      dur: durations,
      from: 0,
      to: 1,
      easing: 'easeOutQuart'
    };

    data.element.animate(animations);
  }
});

// For the sake of the example we update the chart every time it's created with a delay of 10 seconds
chart.on('created', function() {
  if(window.__exampleAnimateTimeout) {
    clearTimeout(window.__exampleAnimateTimeout);
    window.__exampleAnimateTimeout = null;
  }
  window.__exampleAnimateTimeout = setTimeout(chart.update.bind(chart), 12000);
});
	</script>




</body>
<html>
